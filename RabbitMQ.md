# 消息队列

## 一： 什么是消息队列

从通信说起，我想你肯定码过通信相关的代码吧，比如说TCP通信，比如说UDP通信.

它们有一个特点，就是

要么发送端和接受端同时在线，皆大欢喜，你能发送，我能收到

要么接受端挂掉了，如果是UDP的，发送端照样发送，如果是TCP的，发送端会报错

这带来一个潜在的问题

如果消息是很重要呢？

要么发出去被丢弃，要么发出去报错。不管是哪种情况，这个消息都是废了的。

同步的通信模型会出现这种问题。

这个时候，消息队列这个新东西的横空出世了。

它可以**帮发送端把消息存在一个队列中，等到接受端在线时再接受这个消息，提供了一种异步的通信方式**

它的**作用**也体现在这

## 二：消息队列的名词解释

- Producer：消息生产者，负责产生和发送消息到 Broker；也叫发送端

- Broker：消息处理中心。负责消息存储、确认、重试等，一般其中会包含多个 queue；

- > 如果说消息队列要有一个服务器，估计就是这货了

- Consumer：消息消费者，负责从 Broker 中获取消息，并进行相应处理；也叫接受端

## 三：消息队列的特性

1. 异步，减少了同步的等待时间

2. 松耦合，发送端和接口端只需指定消息队列的服务器，并与之通信即可，不用关心和对方通信的是人是狗

3. 分布式，说白了就是一个发送端，可以有多个接受端，一个接受端挂了，千千万万个接受端站起来了。

4. 可靠性，发送端发送消息过去后，消息一般都是存储在本地硬盘里面，直到接受端接受消息，可以选择继续存储或者直接销毁。

   在此之前，消息是安全的，即使发送端，接受端，服务器全挂掉。重启后还是能取到消息的

   ​

   ​



## 二 ：RabbitMQ

### 2.1 what is？

消息队列的提出只是一种思路，其实现还是要靠各位大佬去开发开源软件。

RabbitMQ就是其中一种，相对来说比较流行啦

###2.2怎么安装

安装前提

`rabbitmq-server-3.7.3-1.el7` rpm安装包

`centos7 3.10.0-514.el7.x86_64` 操作系统

如果不满足前提，请查找其他解决方案

第一步：使用 ` rpm -ivh 安装包名` 安装Rabbit软件

> 如果提示需要依赖的话。。
>
> 笔者就遇到两个依赖没装，分别是`erlang`和`socat`
>
> `socat`这个的话直接`yum install socat`即可成功安装
>
> `erlang` 这个稍微有点麻烦
>
> 两种解决方案
>
> 1. 添加repo仓库，直接`yum install erlang`  安装 ，但是repo仓库里面的erlang是古董级的
>
> 2. `erlang` 这个依赖可以通过EPEL仓库安装，但是据说仓库里面的依赖是比较古老的。
>
>    ........所以我用惨痛的经验告诉你们，仓库里面的源真是太古老了，版本要求不够。
>
>    ........所以我继续用惨痛的经验告诉你们，从源代码编译erlang简直丧心病狂，各位对自己能力有信心的，亦或是抖S的，欢迎尝试，成功了一定要告诉我。。。
>
>    .......所以如果你的系统如果是centos7的，恭喜你了。
>
>    RabbitMQ官网也是知道erlang安装的依赖太变态了，提供了一个专用的安装包，仅为RabbitMQ而用
>
>    你不用安装什么鬼依赖了
>
>    当然，不提供`OpenSSL/libcrypto`这个依赖，你需要自己安装。嘛，出来混，总是要还的
>
>    进入这个地址看下吧
>
>    `http://www.rabbitmq.com/install-rpm.html`
>
>    看看`(http://www.rabbitmq.com/install-rpm.html#install-erlang)`

第二步：恭喜你打败第一关的大BOSS了，接下来

安装后的RabbitMQ默认不会开启守护线程，如果想在系统启动时开启守护线程

用root用户执行此命令`chkconfig rabbitmq-server on`

好了，安装完毕。以上。

### 2.3 启动，停止RabbitMQ的Server

启动server：`service rabbitmq-server start`

停止server：`service rabbitmq-server stop`

### 2.4 配置RabbitMQ



### 2.5 端口访问

确保可以越过防火墙访问到以下端口

`4369`   `5672`  `25672` `15672` `61613, 61614` `1883, 8883` `15674` `15675` 

至于原因，我不说，你们也应该知道的吧

当然，这些端口也可以更改的，自己找文档吧

  

### 2.6: 默认用户访问

未配置的情况下，默认Rabbit会使用

用户名：`guest`

密码 : `guest`

来创建一个用户

这个用户只能在本地回环地址访问RabbitMQ的后台管理页面时可用。

外网用不了这个用户，所以如果你想通过外网访问到后台管理页面

得赶紧去创建一个可用的用户

详情请查看访问控制

### 2.7 ：访问控制

首先这里要定义一下认证和授权

这两者通常会被混淆，这里必须理清楚一下

认证是指识别用户是谁

授权是指确定用户能做什么，不能做什么



关于访问控制。

在RabbitMQ Server开始启动时并检测到数据库未初始化或者已被删除的话，就会使用下列信息初始化新的数据库

一个虚拟主机名为`/`

用户名为`guest`密码 为`guest`被授予虚拟主机的所有权限

该用户只能通过本地回环地址访问到服务器，这是通过配置文件`loopback_users` 项进行配置的

如果你想让guest用户在任何地址上都可以登陆连接到服务器，把这项改一下

`loopback_users = none`







  







### 2.3快速入门



## 临时文件

关于linux下tar 命令的使用

这个命令一般是用于解压，以及压缩文件的

常见的命令格式如下`tar -zxvf xx.tar.gz`

其中 `-zxvf`是参数，tar命令支持的参数如下

-c: 建立压缩档案
-x：解压
-t：查看内容
-r：向压缩归档文件末尾追加文件
-u：更新原压缩包中的文件
-z：有gzip属性的  gz   如果你不能确定归档文件是不是gz，建议不要用这个参数，先试一下，再试一下，连试三下
-j：有bz2属性的   bz2
-J ：有xz属性的   xz
-Z：有compress属性的
-v：显示所有过程
-O：将文件解开到标准输出
-f 指定归/解档文件名 后面必须带文件名 

