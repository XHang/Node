# 消息队列

## 一： 什么是消息队列

从通信说起，我想你肯定码过通信相关的代码吧，比如说TCP通信，比如说UDP通信.

它们有一个特点，就是

要么发送端和接受端同时在线，皆大欢喜，你能发送，我能收到

要么接受端挂掉了，如果是UDP的，发送端照样发送，如果是TCP的，发送端会报错

这带来一个潜在的问题

如果消息是很重要呢？

要么发出去被丢弃，要么发出去报错。不管是哪种情况，这个消息都是废了的。

同步的通信模型会出现这种问题。

这个时候，消息队列这个新东西的横空出世了。

它可以**帮发送端把消息存在一个队列中，等到接受端在线时再接受这个消息，提供了一种异步的通信方式**

它的**作用**也体现在这

## 二：消息队列的名词解释

- Producer：消息生产者，负责产生和发送消息到 Broker；也叫发送端

- Broker：消息处理中心。负责消息存储、确认、重试等，一般其中会包含多个 queue；

- > 如果说消息队列要有一个服务器，估计就是这货了

- Consumer：消息消费者，负责从 Broker 中获取消息，并进行相应处理；也叫接受端

## 三：消息队列的特性

1. 异步，减少了同步的等待时间

2. 松耦合，发送端和接口端只需指定消息队列的服务器，并与之通信即可，不用关心和对方通信的是人是狗

3. 分布式，说白了就是一个发送端，可以有多个接受端，一个接受端挂了，千千万万个接受端站起来了。

4. 可靠性，发送端发送消息过去后，消息一般都是存储在本地硬盘里面，直到接受端接受消息，可以选择继续存储或者直接销毁。

   在此之前，消息是安全的，即使发送端，接受端，服务器全挂掉。重启后还是能取到消息的

   ​

   ​



## 二 ：RabbitMQ

### 2.1 what is？

消息队列的提出只是一种思路，其实现还是要靠各位大佬去开发开源软件。

RabbitMQ就是其中一种，相对来说比较流行啦

###2.2怎么安装

安装前提

`rabbitmq-server-3.7.3-1.el7` rpm安装包

`centos7 3.10.0-514.el7.x86_64` 操作系统

如果不满足前提，请查找其他解决方案

第一步：使用 ` rpm -ivh 安装包名` 安装Rabbit软件

> 如果提示需要依赖的话。。
>
> 笔者就遇到两个依赖没装，分别是`erlang`和`socat`
>
> `socat`这个的话直接`yum install socat`即可成功安装
>
> `erlang` 这个稍微有点麻烦
>
> 两种解决方案
>
> 1. 添加repo仓库，直接`yum install erlang`  安装 ，但是repo仓库里面的erlang是古董级的
>
> 2. `erlang` 这个依赖可以通过EPEL仓库安装，但是据说仓库里面的依赖是比较古老的。
>
>    ........所以我用惨痛的经验告诉你们，仓库里面的源真是太古老了，版本要求不够。
>
>    还是老老实实下载源码包自己编译安装
>
>    怎么编译安装？
>
>    假设你已经下载了erlang，笔者用的版本是`otp_src_20.2.tar.gz`
>
>    注：下面的`OTP-VSN`代表源代码包的根目录
>
>    1. 先解压这个压缩文件
>
>    2. 进入解压后的目录，并设置环境变量
>
>       ```
>       cd otp_src_%OTP-VSN%
>       export ERL_TOP=`pwd`
>       ```
>
>    3. 运行这个命令来配置构建
>
>       `./configure`
>
>       默认安装的路径是`/usr/local/{bin,lib/erlang}`
>
>       如果不想使用这个安装路径
>
>       可以用在配置目录后面补上`--prefix=/opt/erlang/%OTP-VSN%`
>
>       手动指定安装目录
>
>    4. 运行这个命令构建
>
>       `make`
>
>    5. 执行完后，应该来一发冒烟测试
>
>       ` make release_tests`
>
>       `cd release/tests/test_server`
>
>       `$ERL_TOP/bin/erl -s ts install -s ts smoke_test batch -s init stop`
>
>       最后在浏览器上打开这个文件
>
>       `$ERL_TOP/release/tests/test_server/index.html`
>
>       确保没有失败的测试
>
>       PS:如果你的系统没有安装这几个东西的话`crypto`, `ssl` and `ssh`
>
>       会有一个失败的测试
>
>    6. 激动人心的时刻到了，开始安装吧
>
>       `make install`
>
>       ​
>
>       ​
>
>    ​







### 2.3快速入门



