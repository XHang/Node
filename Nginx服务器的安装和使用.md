# Nginx服务器的安装和使用

## 一：what this ？

Nginx是一个高效的HTTP和反向代理服务器，也可用做负载均衡，HTTP缓存等服务器

## 二：为什么要学习它？

1. 流行，很多公司在用
2. 提供了一些方便的功能，值得学习

**都提供了什么功能**
1. 路由转发
2. 待定

**Nginx的组成**
由一个主线程和若干个工作线程组成
主线程用于加载和评估配置,并管理工作线程
工作线程用于处理请求
工作线程的个数可以通过配置文件调整

## 三:怎么下载安装

本教程使用的系统版本是centos7:请核对你的系统版本再往下观看

Nginx官网提供的安装教程并不是要你去官网下载二进制包或者源码包自己安装

> 不过这种方式也是行的，只不过不知道怎么安装罢了

而是要你使用yum install nginx 命令自动安装。

当然，单纯的使用这个命令进行安装肯定是挂了，因为yun仓库并没有nginx的安装包可以使用

这个时候，就需要我们配置一个新的yum源了。

步骤如下

1. 创建这个文件`/etc/yum.repos.d/nginx.repo`

2. 补充一下内容到新建的文件中

   ```
   [nginx]
   name=nginx repo
   baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/
   gpgcheck=0
   enabled=1
   ```

   > 其中，OS根据操作系统的不同而不同，如果你的系统是centos，OS应该被替换成centos。
   >
   > 以及OSRELEASE，假设你的centos的版本是7，那么它应该被替换成7.
   >
   > 具体请看官网的说明
   
完成了仓库的配置的话,就可以着手进行安装了
安装的命令就是上面提到的`yum install nginx`

## 四:开始使用

### 3.1 常规操作
**启动**
首先确保你通过以上方式安装了啊
按照后,nginx的路径应该就设置到环境变量path里面了
所以,可以直接敲入命令`nginx`
但是你怎么知道启动起来了呢?
在机器上访问该网站`127.0.0.1` 
看到`Welcome to nginx!`就可以得知启动成功了
** 关闭 **
强制关闭:`nginx -s stop`
正常关闭:`nginx -s quit`
> 谁启动的,就应该由谁关闭

重启加载配置文件:`nginx -s reload `
> 内部的工作流程是酱紫的
主线程接受到此命令,校验配置文件是否有效
如果有效,启动新的主线程,并请求工作线程关闭,工作线程则拒绝接受新的请求,并完成当前的请求后关闭工作线程
如果无效,回滚配置,使用旧的配置

重新打开日志文件`nginx -s reopen `

### 3.2 更改配置文件
首先,配置文件的目录默认位于
`/usr/local/nginx/conf`  
或者
` /usr/local/etc/nginx`
或者
`/etc/nginx`
这么多种路径,总有一个适合你
> 笔者在`/etc/nginx`

然后配置文件的名称叫做`nginx.conf`

#### 3.2.1 配置文件的语法
Nginx的配置文件语法有两种
1. 第一种是key-value形式的
`key value;` 也被叫做简单指令

2. 第二种类似于Json的对象语法,叫做块指令
```
http {
    server {
    }
}
```
其实按我的理解,块指令,就是给简单指令一个房子住的,让这个孤零零的简单指令有了归属,又或者是说,对于处在块指令的简单指令来说.块指令就是他的上下文.

另外,也有简单指令非常孤傲,它们不需要块指令罩着,直接就是孤零零的处在配置文件中,它们也有上下文,上下文就是这个配置文件,被称为主上下文.


### 3.2 应用
#### 3.2.1 显示静态内容
什么是静态内容,就是html,图片之类的,不需要后端参与的文件内容
这次我们将尝试用Nginx,来显示html文件和一张图片
详细功能描述:
nginx能访问到文件系统路径`/data/www`里面的html文件,并通过一个URL路径,将该文件显示出来.
还能访问文件系统路径`/data`里面的图片文件,并通过一个URL路径,将图片显示出来
很简单.我们要做的事情有
1. 创建上文谈到的两个路径,并准备对应的文件放进行
> 只要有基本的linux操作知识就可以做到

2. 更改配置文件
直接把配置文件列出来吧(位于http的上下文中)
```
  server{ 
  # 将请求地址和`localhost`后面的`path` 进行最长匹配,能匹配到就用这个配置
        localhost /{
  # 匹配成功,返回/data/www文件夹里面的东西        
                root /data/wwww;
        }
        localhost /images{
                root /data;
        }
    }
```
> 说一声哈
一个配置文件可以包含多个server.
每个server可以用名称和端口进行区分

3. 让Nginx重新加载配置文件
`nginx -s reload`





 
   




